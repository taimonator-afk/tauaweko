<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tau Āweko - Te Whare o Raukura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Assessment Data
        const assessmentData = {
            entry_password: "Raukura",
            base_logic: [
                {base: "tahi", pu: "tahipū", pu_value: 2, tautahi: "tahipū tautahi", tautahi_value: 3},
                {base: "rua", pu: "ruapū", pu_value: 4, tautahi: "ruapū tautahi", tautahi_value: 5},
                {base: "toru", pu: "torupū", pu_value: 6, tautahi: "torupū tautahi", tautahi_value: 7},
                {base: "whā", pu: "whāpū", pu_value: 8, tautahi: "whāpū tautahi", tautahi_value: 9},
                {base: "rima", pu: "rimapū", pu_value: 10, tautahi: "rimapū tautahi", tautahi_value: 11},
                {base: "ono", pu: "onopū", pu_value: 12, tautahi: "onopū tautahi", tautahi_value: 13},
                {base: "whitu", pu: "whitupū", pu_value: 14, tautahi: "whitupū tautahi", tautahi_value: 15},
                {base: "waru", pu: "warupū", pu_value: 16, tautahi: "warupū tautahi", tautahi_value: 17},
                {base: "iwa", pu: "iwapū", pu_value: 18, tautahi: "iwapū tautahi", tautahi_value: 19},
                {base: "ngahuru", pu: "ngahurupū", pu_value: 20, tautahi: "ngahurupū tautahi", tautahi_value: 21}
            ]
        };

        // State
        let state = {
            currentUser: null,
            loginName: '',
            currentView: 'login',
            userProgress: {},
            assessmentPassword: '',
            assessmentUnlocked: false,
            assessmentAnswers: {},
            assessmentQuestions: [],
            assessmentSubmitted: false,
            interactiveProblem: null,
            interactiveAnswer: '',
            interactiveFeedback: ''
        };

        // Storage functions
        function saveProgress() {
            localStorage.setItem('progress:' + state.currentUser, JSON.stringify(state.userProgress));
        }

        function loadProgress() {
            const data = localStorage.getItem('progress:' + state.currentUser);
            if (data) {
                state.userProgress = JSON.parse(data);
            }
        }

        // Generate questions
        function generateAssessmentQuestions() {
            const questions = [];
            const baseLogic = assessmentData.base_logic;
            
            for (let i = 0; i < 5; i++) {
                const item = baseLogic[Math.floor(Math.random() * baseLogic.length)];
                const type = Math.random() > 0.5 ? 'pu' : 'tautahi';
                const term = type === 'pu' ? item.pu : item.tautahi;
                const correctAnswer = type === 'pu' ? item.pu_value : item.tautahi_value;
                
                const options = new Set([correctAnswer]);
                while (options.size < 4) {
                    const randomItem = baseLogic[Math.floor(Math.random() * baseLogic.length)];
                    const randomValue = Math.random() > 0.5 ? randomItem.pu_value : randomItem.tautahi_value;
                    options.add(randomValue);
                }
                
                questions.push({
                    type: 'multiple_choice',
                    question: 'What does ' + term + ' mean?',
                    options: Array.from(options).sort((a, b) => a - b),
                    answer: correctAnswer.toString()
                });
            }
            
            for (let i = 0; i < 5; i++) {
                const item = baseLogic[Math.floor(Math.random() * baseLogic.length)];
                const type = Math.random() > 0.33 ? (Math.random() > 0.5 ? 'pu' : 'tautahi') : 'base';
                let term, answer;
                
                if (type === 'base') {
                    term = item.base;
                    answer = baseLogic.findIndex(x => x.base === item.base) + 1;
                } else if (type === 'pu') {
                    term = item.pu;
                    answer = item.pu_value;
                } else {
                    term = item.tautahi;
                    answer = item.tautahi_value;
                }
                
                questions.push({
                    type: 'text_input',
                    question: 'Convert to number: ' + term,
                    answer: answer.toString()
                });
            }
            
            for (let i = 0; i < 5; i++) {
                const item = baseLogic[Math.floor(Math.random() * baseLogic.length)];
                const type = Math.random() > 0.5 ? 'pu' : 'tautahi';
                const value = type === 'pu' ? item.pu_value : item.tautahi_value;
                const answer = type === 'pu' ? item.pu : item.tautahi;
                
                questions.push({
                    type: 'text_input',
                    question: 'Convert to Maori: ' + value,
                    answer: answer
                });
            }
            
            state.assessmentQuestions = questions;
        }

        function generateInteractiveProblem() {
            const baseLogic = assessmentData.base_logic;
            const types = ['base', 'pu', 'tautahi'];
            const type = types[Math.floor(Math.random() * types.length)];
            const item = baseLogic[Math.floor(Math.random() * baseLogic.length)];
            
            let question, answer;
            if (type === 'base') {
                const baseIndex = baseLogic.findIndex(x => x.base === item.base);
                question = 'What is the value of ' + item.base + '?';
                answer = (baseIndex + 1).toString();
            } else if (type === 'pu') {
                question = 'What is the value of ' + item.pu + '?';
                answer = item.pu_value.toString();
            } else {
                question = 'What is the value of ' + item.tautahi + '?';
                answer = item.tautahi_value.toString();
            }
            
            state.interactiveProblem = { question, answer };
            state.interactiveAnswer = '';
            state.interactiveFeedback = '';
        }

        // Render functions
        function render() {
            const app = document.getElementById('app');
            
            if (!state.currentUser) {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-slate-800 via-blue-900 to-slate-900 flex items-center justify-center p-4">
                        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
                            <div class="text-center mb-6">
                                <h1 class="text-3xl font-bold text-blue-900 mb-2">TE WHARE O RAUKURA</h1>
                                <h2 class="text-xl font-semibold text-gray-700 mb-2">Tau Āweko</h2>
                                <p class="text-gray-600">The Logic of Numbers</p>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ko wai koe? (What is your name?)</label>
                                    <input id="loginInput" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your name" autocomplete="off">
                                </div>
                                <button onclick="handleLogin()" class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors font-semibold">Haere Mai (Welcome)</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('loginInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
                return;
            }

            const lessonsCompleted = Object.keys(state.userProgress.lessons || {}).length;
            const assessmentsCompleted = Object.keys(state.userProgress.assessments || {}).length;

            if (state.currentView === 'dashboard') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div class="max-w-7xl mx-auto">
                            <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                </div>
                                <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <span>${state.currentUser}</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                </button>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <div class="mb-6">
                                    <h2 class="text-2xl font-bold text-blue-900 mb-2">Kia ora, ${state.currentUser}!</h2>
                                    <p class="text-gray-600">Continue learning Tau Āweko</p>
                                </div>
                                <div class="grid md:grid-cols-3 gap-6 mb-6">
                                    <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                                        <svg class="w-8 h-8 text-blue-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                                        <h3 class="font-bold text-lg">Ngā Akoranga (Lessons)</h3>
                                        <p class="text-2xl font-bold text-blue-600">${lessonsCompleted}/3</p>
                                        <p class="text-sm text-gray-600">completed</p>
                                    </div>
                                    <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                                        <svg class="w-8 h-8 text-green-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"></circle><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"></path></svg>
                                        <h3 class="font-bold text-lg">Ngā Aromatawai (Assessments)</h3>
                                        <p class="text-2xl font-bold text-green-600">${assessmentsCompleted}/1</p>
                                        <p class="text-sm text-gray-600">completed</p>
                                    </div>
                                    <div class="bg-purple-50 p-6 rounded-lg border-2 border-purple-200">
                                        <svg class="w-8 h-8 text-purple-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                                        <h3 class="font-bold text-lg">Whakamātau (Practice)</h3>
                                        <p class="text-2xl font-bold text-purple-600">${state.userProgress.interactive?.attempted || 0}</p>
                                        <p class="text-sm text-gray-600">problems attempted</p>
                                    </div>
                                </div>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-lg shadow-md p-6">
                                        <h3 class="text-xl font-bold text-blue-900 mb-4 flex items-center">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                                            Ngā Akoranga (Lessons)
                                        </h3>
                                        <div class="space-y-3">
                                            <button onclick="goToView('lesson1')" class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors">
                                                <span class="flex items-center">
                                                    ${state.userProgress.lessons?.lesson1 ? '<svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : '<svg class="w-5 h-5 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>'}
                                                    Lesson 1
                                                </span>
                                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                            <button onclick="goToView('lesson2')" class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors">
                                                <span class="flex items-center">
                                                    ${state.userProgress.lessons?.lesson2 ? '<svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : '<svg class="w-5 h-5 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>'}
                                                    Lesson 2
                                                </span>
                                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                            <button onclick="goToView('lesson3')" class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors">
                                                <span class="flex items-center">
                                                    ${state.userProgress.lessons?.lesson3 ? '<svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : '<svg class="w-5 h-5 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>'}
                                                    Lesson 3
                                                </span>
                                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-lg shadow-md p-6">
                                        <h3 class="text-xl font-bold text-blue-900 mb-4 flex items-center">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"></circle><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"></path></svg>
                                            Ngā Aromatawai & Taputapu
                                        </h3>
                                        <div class="space-y-3">
                                            <button onclick="window.open('https://www.canva.com/design/DAG4hEW6AQQ/w1m2vt6frNvsfqXsmNcT7w/view', '_blank')" class="w-full flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 rounded-lg border-2 border-purple-200 transition-colors">
                                                <span class="flex items-center">
                                                    <svg class="w-5 h-5 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                                                    <span class="font-semibold">Canva Presentation</span>
                                                </span>
                                                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                            <button onclick="goToView('assessment')" class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-green-50 rounded-lg transition-colors">
                                                <span class="flex items-center">
                                                    ${state.userProgress.assessments?.raukura ? '<svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : '<svg class="w-5 h-5 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>'}
                                                    Raukura Assessment
                                                </span>
                                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                            <button onclick="goToView('interactive')" class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-purple-50 rounded-lg transition-colors">
                                                <span class="flex items-center">
                                                    <svg class="w-5 h-5 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                                                    Interactive Practice
                                                </span>
                                                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.currentView.startsWith('lesson')) {
                const lessons = {
                    lesson1: { 
                        title: 'Introduction to Base Numbers', 
                        content: `
                            <div class="space-y-4">
                                <p class="text-lg">Welcome to Tau Āweko! In Te Reo Māori, we have base numbers that form the foundation of our counting system.</p>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h3 class="font-bold mb-2">Base Numbers (1-10):</h3>
                                    <ul class="space-y-1">
                                        <li>tahi = 1</li>
                                        <li>rua = 2</li>
                                        <li>toru = 3</li>
                                        <li>whā = 4</li>
                                        <li>rima = 5</li>
                                        <li>ono = 6</li>
                                        <li>whitu = 7</li>
                                        <li>waru = 8</li>
                                        <li>iwa = 9</li>
                                        <li>ngahuru = 10</li>
                                    </ul>
                                </div>
                            </div>
                        `
                    },
                    lesson2: { 
                        title: 'Understanding pū - Doubling', 
                        content: `
                            <div class="space-y-4">
                                <p class="text-lg">Adding pū to any base number doubles its value (×2).</p>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h3 class="font-bold mb-2">Examples:</h3>
                                    <ul class="space-y-2">
                                        <li>rima (5) becomes rimapū = 10</li>
                                        <li>toru (3) becomes torupū = 6</li>
                                        <li>whā (4) becomes whāpū = 8</li>
                                    </ul>
                                </div>
                            </div>
                        `
                    },
                    lesson3: { 
                        title: 'Understanding tautahi - Plus One', 
                        content: `
                            <div class="space-y-4">
                                <p class="text-lg">After doubling with pū, we can add tautahi to add one more.</p>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h3 class="font-bold mb-2">Examples:</h3>
                                    <ul class="space-y-2">
                                        <li>rimapū tautahi = 11</li>
                                        <li>torupū tautahi = 7</li>
                                        <li>tahipū tautahi = 3</li>
                                    </ul>
                                </div>
                                <p class="font-semibold text-red-600">Important: tautahi can only be used after pū!</p>
                            </div>
                        `
                    }
                };
                const lesson = lessons[state.currentView];
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div class="max-w-7xl mx-auto">
                            <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                    <button onclick="goToView('dashboard')" class="text-blue-600 hover:text-blue-800 text-sm">Back to Dashboard</button>
                                </div>
                                <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <span>${state.currentUser}</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                </button>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <div class="max-w-3xl mx-auto">
                                    <h2 class="text-2xl font-bold text-blue-900 mb-6">${lesson.title}</h2>
                                    ${lesson.content}
                                    <button onclick="markLessonComplete('${state.currentView}')" class="mt-6 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Mark as Complete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.currentView === 'assessment') {
                if (!state.assessmentUnlocked) {
                    app.innerHTML = `
                        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                            <div class="max-w-7xl mx-auto">
                                <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                        <button onclick="goToView('dashboard')" class="text-blue-600 hover:text-blue-800 text-sm">Back to Dashboard</button>
                                    </div>
                                    <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        <span>${state.currentUser}</span>
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                    </button>
                                </div>
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="max-w-3xl mx-auto">
                                        <div class="bg-blue-50 p-8 rounded-lg text-center">
                                            <h2 class="text-2xl font-bold text-blue-900 mb-4">Raukura Te Taura Whakamātau</h2>
                                            <p class="text-gray-700 mb-6">Me whakauru i te kupuhuna kia uru<br />(Enter the password to begin)</p>
                                            <div class="max-w-md mx-auto space-y-4">
                                                <input id="passwordInput" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Kupuhuna">
                                                <button onclick="handlePasswordSubmit()" class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors">Tomo (Enter)</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') handlePasswordSubmit();
                    });
                } else if (state.assessmentSubmitted) {
                    const score = state.userProgress.assessments?.raukura?.score || 0;
                    app.innerHTML = `
                        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                            <div class="max-w-7xl mx-auto">
                                <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                        <button onclick="goToView('dashboard')" class="text-blue-600 hover:text-blue-800 text-sm">Back to Dashboard</button>
                                    </div>
                                    <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        <span>${state.currentUser}</span>
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                    </button>
                                </div>
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="max-w-3xl mx-auto text-center">
                                        <svg class="w-16 h-16 text-yellow-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"></circle><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"></path></svg>
                                        <h2 class="text-2xl font-bold text-blue-900 mb-2">Assessment Complete!</h2>
                                        <p class="text-4xl font-bold text-blue-600 mb-4">${score}%</p>
                                        <div class="bg-blue-50 p-6 rounded-lg mb-6">
                                            <p class="text-gray-800">${score >= 80 ? 'Excellent work!' : score >= 60 ? 'Good job! Keep practicing.' : 'Kia kaha! Keep learning and try again!'}</p>
                                        </div>
                                        <button onclick="resetAssessment()" class="bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors">Hoki ki te Papa (Back to Dashboard)</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    let questionsHTML = '';
                    state.assessmentQuestions.forEach((q, i) => {
                        if (q.type === 'multiple_choice') {
                            let optionsHTML = '';
                            q.options.forEach(opt => {
                                optionsHTML += `<label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="q${i}" value="${opt}" onchange="setAnswer(${i}, '${opt}')" class="text-blue-600"><span>${opt}</span></label>`;
                            });
                            questionsHTML += `<div class="bg-white p-4 rounded-lg border-2 border-blue-200"><p class="font-semibold mb-3">${i + 1}. ${q.question}</p><div class="space-y-2">${optionsHTML}</div></div>`;
                        } else {
                            questionsHTML += `<div class="bg-white p-4 rounded-lg border-2 border-blue-200"><p class="font-semibold mb-3">${i + 1}. ${q.question}</p><input type="text" id="answer${i}" onchange="setAnswer(${i}, this.value)" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Tuhia tō whakautu (Enter your answer)" autocomplete="off"></div>`;
                        }
                    });
                    
                    app.innerHTML = `
                        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                            <div class="max-w-7xl mx-auto">
                                <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                        <button onclick="goToView('dashboard')" class="text-blue-600 hover:text-blue-800 text-sm">Back to Dashboard</button>
                                    </div>
                                    <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        <span>${state.currentUser}</span>
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                    </button>
                                </div>
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="max-w-3xl mx-auto">
                                        <h2 class="text-2xl font-bold text-blue-900 mb-2">Raukura Te Taura Whakamātau</h2>
                                        <p class="text-gray-600 mb-6 italic">He aromatawai tatauranga tawhito tēnei!</p>
                                        <div class="space-y-6">${questionsHTML}</div>
                                        <button onclick="submitAssessment()" class="mt-6 bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors disabled:bg-gray-400">Tuku (Submit Assessment)</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } else if (state.currentView === 'interactive') {
                if (!state.interactiveProblem) {
                    generateInteractiveProblem();
                }
                
                const statsHTML = state.userProgress.interactive ? `
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-bold mb-2">Your Stats:</h3>
                        <p>Attempted: ${state.userProgress.interactive.attempted}</p>
                        <p>Correct: ${state.userProgress.interactive.correct}</p>
                        <p>Accuracy: ${state.userProgress.interactive.attempted > 0 ? Math.round((state.userProgress.interactive.correct / state.userProgress.interactive.attempted) * 100) : 0}%</p>
                    </div>
                ` : '';
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div class="max-w-7xl mx-auto">
                            <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <h1 class="text-2xl font-bold text-blue-900">Tau Āweko</h1>
                                    <button onclick="goToView('dashboard')" class="text-blue-600 hover:text-blue-800 text-sm">Back to Dashboard</button>
                                </div>
                                <button onclick="handleLogout()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-800">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <span>${state.currentUser}</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                </button>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <div class="max-w-3xl mx-auto">
                                    <h2 class="text-2xl font-bold text-blue-900 mb-6">Interactive Practice</h2>
                                    <div class="bg-white p-6 rounded-lg border-2 border-blue-200">
                                        <div class="space-y-4">
                                            <p class="text-xl font-semibold">${state.interactiveProblem.question}</p>
                                            <input id="interactiveInput" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Answer" autocomplete="off">
                                            <div class="flex gap-2">
                                                <button onclick="checkInteractiveAnswer()" class="bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors">Check Answer</button>
                                                <button onclick="newInteractiveProblem()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">New Problem</button>
                                            </div>
                                            ${state.interactiveFeedback ? `<div class="p-4 rounded-lg ${state.interactiveFeedback.includes('Correct') ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${state.interactiveFeedback}</div>` : ''}
                                        </div>
                                    </div>
                                    ${statsHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('interactiveInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') checkInteractiveAnswer();
                });
            }
        }

        // Event handlers
        function handleLogin() {
            const input = document.getElementById('loginInput');
            if (input && input.value.trim()) {
                state.currentUser = input.value.trim();
                state.currentView = 'dashboard';
                loadProgress();
                render();
            } else {
                alert('Please enter your name');
            }
        }

        function handleLogout() {
            state.currentUser = null;
            state.currentView = 'login';
            state.userProgress = {};
            render();
        }

        function goToView(view) {
            state.currentView = view;
            render();
        }

        function markLessonComplete(lessonId) {
            if (!state.userProgress.lessons) state.userProgress.lessons = {};
            state.userProgress.lessons[lessonId] = true;
            saveProgress();
            state.currentView = 'dashboard';
            render();
        }

        function handlePasswordSubmit() {
            const input = document.getElementById('passwordInput');
            if (input.value === assessmentData.entry_password) {
                state.assessmentUnlocked = true;
                generateAssessmentQuestions();
                render();
            } else {
                alert('Incorrect password. Try: Raukura');
            }
        }

        function setAnswer(index, value) {
            state.assessmentAnswers[index] = value;
        }

        function submitAssessment() {
            let correct = 0;
            state.assessmentQuestions.forEach((q, i) => {
                if (state.assessmentAnswers[i] && state.assessmentAnswers[i].toLowerCase().trim() === q.answer.toLowerCase().trim()) {
                    correct++;
                }
            });
            const score = Math.round((correct / state.assessmentQuestions.length) * 100);
            
            if (!state.userProgress.assessments) state.userProgress.assessments = {};
            state.userProgress.assessments.raukura = { completed: true, score };
            saveProgress();
            state.assessmentSubmitted = true;
            render();
        }

        function resetAssessment() {
            state.assessmentSubmitted = false;
            state.assessmentAnswers = {};
            state.assessmentUnlocked = false;
            state.assessmentPassword = '';
            state.currentView = 'dashboard';
            render();
        }

        function checkInteractiveAnswer() {
            const input = document.getElementById('interactiveInput');
            if (!input) return;
            
            state.interactiveAnswer = input.value;
            
            if (state.interactiveAnswer === state.interactiveProblem.answer) {
                state.interactiveFeedback = 'Correct! Ka pai!';
                if (!state.userProgress.interactive) state.userProgress.interactive = { attempted: 0, correct: 0 };
                state.userProgress.interactive.attempted++;
                state.userProgress.interactive.correct++;
            } else {
                state.interactiveFeedback = 'Not quite. The answer is ' + state.interactiveProblem.answer;
                if (!state.userProgress.interactive) state.userProgress.interactive = { attempted: 0, correct: 0 };
                state.userProgress.interactive.attempted++;
            }
            saveProgress();
            render();
        }

        function newInteractiveProblem() {
            generateInteractiveProblem();
            render();
        }

        // Initial render
        render();
    </script>
</body>
</html>